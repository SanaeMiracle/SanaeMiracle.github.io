<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="字符串的扩展字符的 Unicode 表示法JavaScript 允许采用\uxxxx形式表示一个字符，其中xxxx表示字符的 Unicode 码点。     &#39;\u0061&#39;     &#x2F;&#x2F; &quot;a&quot;  但是，这种表示法只限于码点在\u0000~\uFFFF之间的字符。超出这个范围的字符，必须用两个双字节的形式表示 ES6 对这一点做出了改进，只要将码点放入大括号，">
<meta property="og:type" content="article">
<meta property="og:title" content="字符串的扩展">
<meta property="og:url" content="http://example.com/2022/07/26/ES6/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%89%A9%E5%B1%95/index.html">
<meta property="og:site_name" content="Fang">
<meta property="og:description" content="字符串的扩展字符的 Unicode 表示法JavaScript 允许采用\uxxxx形式表示一个字符，其中xxxx表示字符的 Unicode 码点。     &#39;\u0061&#39;     &#x2F;&#x2F; &quot;a&quot;  但是，这种表示法只限于码点在\u0000~\uFFFF之间的字符。超出这个范围的字符，必须用两个双字节的形式表示 ES6 对这一点做出了改进，只要将码点放入大括号，">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-07-26T13:19:08.000Z">
<meta property="article:modified_time" content="2022-07-26T14:57:09.328Z">
<meta property="article:author" content="Fangck">
<meta property="article:tag" content="javaScript">
<meta property="article:tag" content="ES6">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/2022/07/26/ES6/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%89%A9%E5%B1%95/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>字符串的扩展 | Fang</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Fang</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/07/26/ES6/%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%89%A9%E5%B1%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Fangck">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Fang">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          字符串的扩展
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-07-26 21:19:08 / 修改时间：22:57:09" itemprop="dateCreated datePublished" datetime="2022-07-26T21:19:08+08:00">2022-07-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ES6/" itemprop="url" rel="index"><span itemprop="name">ES6</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="字符串的扩展"><a href="#字符串的扩展" class="headerlink" title="字符串的扩展"></a>字符串的扩展</h1><h2 id="字符的-Unicode-表示法"><a href="#字符的-Unicode-表示法" class="headerlink" title="字符的 Unicode 表示法"></a>字符的 Unicode 表示法</h2><p>JavaScript 允许采用<code>\uxxxx</code>形式表示一个字符，其中<code>xxxx</code>表示字符的 Unicode 码点。</p>
<pre><code>    &#39;\u0061&#39;
    // &quot;a&quot;
</code></pre>
<p>但是，这种表示法只限于码点在<code>\u0000~\uFFFF</code>之间的字符。超出这个范围的字符，必须用两个双字节的形式表示</p>
<p>ES6 对这一点做出了改进，只要将码点放入大括号，就能正确解读该字符</p>
<pre><code>    &#39;\u&#123;20BB7&#125;&#39;
    // &quot;𠮷&quot;

    &#39;\u&#123;41&#125;\u&#123;42&#125;\u&#123;43&#125;&#39;
    // &quot;ABC&quot;

    let hello = 123
    hello // 123

    &#39;\u&#123;1F680&#125;&#39; === &#39;\uD83D\uDE80&#39;
    // true
</code></pre>
<p>上面代码中，最后一个例子表明，大括号表示法与四字节的 UTF-16 编码是等价的。</p>
<p>有了这种表示法之后，JavaScript 共有 6 种方法可以表示一个字符</p>
<pre><code>    &#39;z&#39; === &#39;z&#39; // true
    &#39;\172&#39; === &#39;z&#39; // true
    &#39;\x7A&#39; === &#39;z&#39; // true
    &#39;\u007A&#39; === &#39;z&#39; // true
    &#39;\u&#123;7A&#125;&#39; === &#39;z&#39; // true
</code></pre>
<h2 id="codePointAt"><a href="#codePointAt" class="headerlink" title="codePointAt()"></a>codePointAt()</h2><p>JavaScript 内部，字符以 UTF-16 的格式储存，每个字符固定为2个字节。对于那些需要4个字节储存的字符(Unicode 码点大于<code>0xFFFF</code>的字符)，JavaScript 会认为它们是两个字符</p>
<pre><code>    var s = &#39;𠮷&#39;

    s.length // 2
    s.charAt(0) // &#39;&#39;
    s.charAt(1) // &#39;&#39;
    s.charCodeAt(0) // 55362
    s.charCodeAt(1) // 57271
</code></pre>
<p>上面代码中，汉字“𠮷”(注意，这个字不是“吉祥”的“吉”)的码点是<code>0x20BB7</code>，UTF-16 编码为<code>0xD842 0xDFB7</code>(十进制为<code>55362 57271</code>)，需要4个字节储存。对于这种4个字节的字符，JavaScript 不能正确处理，字符串长度会误判为2，而且<code>charAt</code>方法无法读取整个字符，<code>charCodeAt</code>方法只能分别返回前两个字节和后两个字节的值</p>
<p>ES6 提供了<code>codePointAt</code>方法，能够正确处理 4 个字节储存的字符，返回一个字符的码点。</p>
<pre><code>    let s = &#39;𠮷a&#39;

    s.codePointAt(0) // 134071
    s.codePointAt(1) // 57271

    s.codePointAt(2) // 97
</code></pre>
<p><code>codePointAt</code>方法的参数，是字符在字符串中的位置(从 0 开始)。上面代码中，JavaScript 将“<code>𠮷 a</code>”视为三个字符，<code>codePointAt</code> 方法在第一个字符上，正确地识别了“𠮷”，返回了它的十进制码点 <code>134071</code>(即十六进制的<code>20BB7</code>)。在第二个字符(即“𠮷”的后两个字节)和第三个字符“a”上，<code>codePointAt</code>方法的结果与<code>charCodeAt</code>方法相同。 </p>
<p>总之，<code>codePointAt</code>方法会正确返回 32 位的 UTF-16 字符的码点。对于那些两个字节储存的常规字符，它的返回结果与charCodeAt方法相同。 </p>
<p><code>codePointAt</code>方法返回的是码点的十进制值，如果想要十六进制的值，可以使用<code>toString</code>方法转换一下。</p>
<pre><code>    let s = &#39;𠮷a&#39;

    s.codePointAt(0).toString(16) // &quot;20bb7&quot;
    s.codePointAt(2).toString(16) // &quot;61&quot;
</code></pre>
<p>您可能注意到了，<code>codePointAt</code>方法的参数，仍然是不正确的。比如，上面代码中，字符a在字符串s的正确位置序号应该是 1，但是必须向<code>codePointAt</code>方法传入 2。解决这个问题的一个办法是使用<code>for...of</code>循环，因为它会正确识别 32 位的 UTF-16 字符</p>
<pre><code>    let s = &#39;𠮷a&#39;
    for (let ch of s) &#123;
        console.log(ch.codePointAt(0).toString(16))
    &#125;
    // 20bb7
    // 6
</code></pre>
<h2 id="String-fromCodePoint"><a href="#String-fromCodePoint" class="headerlink" title="String.fromCodePoint()"></a>String.fromCodePoint()</h2><p>ES5 提供<code>String.fromCharCode</code>方法，用于从码点返回对应字符，但是这个方法不能识别 32 位的 UTF-16 字符(Unicode 编号大于<code>0xFFFF</code>)。</p>
<pre><code>    String.fromCharCode(0x20bb7)
    // &quot;ஷ&quot;
</code></pre>
<p>上面代码中，<code>String.fromCharCode</code>不能识别大于<code>0xFFFF</code>的码点，所以<code>0x20BB7</code>就发生了溢出，最高位2被舍弃了，最后返回码点<code>U+0BB7</code>对应的字符，而不是码点<code>U+20BB7</code>对应的字符。 </p>
<p>ES6 提供了<code>String.fromCodePoint</code>方法，可以识别大于<code>0xFFFF</code>的字符，弥补了<code>String.fromCharCode</code>方法的不足。在作用上，正好与<code>codePointAt</code>方法相反。</p>
<pre><code>    String.fromCodePoint(0x20bb7)
    // &quot;𠮷&quot;
    String.fromCodePoint(0x78, 0x1f680, 0x79) === &quot;x\uD83D\uDE80y&quot;
    // true
</code></pre>
<p>上面代码中，如果<code>String.fromCodePoint</code>方法有多个参数，则它们会被合并成一个字符串返回。 </p>
<p>注意，<code>fromCodePoint</code>方法定义在<code>String</code>对象上，而<code>codePointAt</code>方法定义在字符串的实例对象上</p>
<h2 id="字符串的遍历器接口"><a href="#字符串的遍历器接口" class="headerlink" title="字符串的遍历器接口"></a>字符串的遍历器接口</h2><p>ES6 为字符串添加了遍历器接口，使得字符串可以被<code>for...of</code>循环遍历。</p>
<pre><code>    for (let codePoint of &#39;foo&#39;) &#123;
        console.log(codePoint)
    &#125;
    // &quot;f&quot;
    // &quot;o&quot;
    // &quot;o&quot;
</code></pre>
<p>除了遍历字符串，这个遍历器最大的优点是可以识别大于<code>0xFFFF</code>的码点，传统的<code>for</code>循环无法识别这样的码点</p>
<pre><code>    let text = String.fromCodePoint(0x20bb7)

    for (let i = 0; i &lt; text.length; i++) &#123;
        console.log(text[i])
    &#125;
    // &quot; &quot;
    // &quot; &quot;

    for (let i of text) &#123;
        console.log(i)
    &#125;
    // &quot;𠮷&quot;
</code></pre>
<p>上面代码中，字符串<code>text</code>只有一个字符，但是<code>for</code>循环会认为它包含两个字符(都不可打印)，而<code>for...of</code>循环会正确识别出这一个字符</p>
<h2 id="includes-startsWith-endsWith"><a href="#includes-startsWith-endsWith" class="headerlink" title="includes(), startsWith(), endsWith()"></a>includes(), startsWith(), endsWith()</h2><p>传统上，JavaScript 只有<code>indexOf</code>方法，可以用来确定一个字符串是否包含在另一个字符串中。<br>ES6 又提供了三种新方法。 </p>
<ul>
<li><p><code>includes()</code>: 返回布尔值，表示是否找到了参数字符串。 </p>
</li>
<li><p><code>startsWith()</code>: 返回布尔值，表示参数字符串是否在原字符串的头部。 </p>
</li>
<li><p><code>endsWith()</code>: 返回布尔值，表示参数字符串是否在原字符串的尾部</p>
<pre><code>  let s = &#39;Hello world!&#39;

  s.startsWith(&#39;Hello&#39;) // true
  s.endsWith(&#39;!&#39;) // true
  s.includes(&#39;o&#39;) // true
</code></pre>
</li>
</ul>
<p>这三个方法都支持第二个参数，表示开始搜索的位置</p>
<pre><code>    let s = &#39;Hello world!&#39;

    s.startsWith(&#39;world&#39;, 6) // true
    s.endsWith(&#39;Hello&#39;, 5) // true
    s.includes(&#39;Hello&#39;, 6) // false
</code></pre>
<p>上面代码表示，使用第二个参数n时，<code>endsWith</code>的行为与其他两个方法有所不同。它针对前<code>n</code>个字符，而其他两个方法针对从第<code>n</code>个位置直到字符串结束</p>
<h2 id="repeat"><a href="#repeat" class="headerlink" title="repeat()"></a>repeat()</h2><p><code>repeat</code>方法返回一个新字符串，表示将原字符串重复<code>n</code>次。</p>
<pre><code>    &#39;x&#39;.repeat(3) // &quot;xxx&quot;
    &#39;hello&#39;.repeat(2) // &quot;hellohello&quot;
    &#39;na&#39;.repeat(0) // &quot;&quot;
</code></pre>
<p>参数如果是小数，会被取整。</p>
<pre><code>    &quot;na&quot;.repeat(2.9) // &quot;nana&quot;
</code></pre>
<p>如果<code>repeat</code>的参数是负数或者<code>Infinity</code>，会报错</p>
<pre><code>    &#39;na&#39;.repeat(Infinity)
    // RangeError
    &#39;na&#39;.repeat(-1)
    // RangeError
</code></pre>
<p>但是，如果参数是 0 到-1 之间的小数，则等同于 0，这是因为会先进行取整运算。0 到-1 之间的小数，取整以后等于-0，<code>repeat</code>视同为 0</p>
<pre><code>    &quot;na&quot;.repeat(-0.9) // &quot;&quot;
</code></pre>
<p>参数NaN等同于 0。 </p>
<pre><code>    &quot;na&quot;.repeat(NaN); // &quot;&quot;
</code></pre>
<p>如果<code>repeat</code>的参数是字符串，则会先转换成数字。 </p>
<pre><code>    &quot;na&quot;.repeat(&quot;na&quot;) // &quot;&quot;
    &quot;na&quot;.repeat(&quot;3&quot;) // &quot;nanana&quot;
</code></pre>
<h2 id="padStart-，padEnd"><a href="#padStart-，padEnd" class="headerlink" title="padStart()，padEnd()"></a>padStart()，padEnd()</h2><p>ES2017 引入了字符串补全长度的功能。如果某个字符串不够指定长度，会在头部或尾部补全。<br><code>padStart()</code>用于头部补全，<code>padEnd()</code>用于尾部补全</p>
<pre><code>    &quot;x&quot;.padStart(5, &quot;ab&quot;) // &#39;ababx&#39;
    &quot;x&quot;.padStart(4, &quot;ab&quot;) // &#39;abax&#39;
    
    &quot;x&quot;.padEnd(5, &quot;ab&quot;) // &#39;xabab&#39;
    &quot;x&quot;.padEnd(4, &quot;ab&quot;) // &#39;xaba&#39;
</code></pre>
<p>上面代码中，<code>padStart</code>和<code>padEnd</code>一共接受两个参数，第一个参数用来指定字符串的最小长度，第二个参数是用来补全的字符串。</p>
<p>如果原字符串的长度，等于或大于指定的最小长度，则返回原字符串</p>
<pre><code>    &#39;xxx&#39;.padStart(2, &#39;ab&#39;) // &#39;xxx&#39;
    &#39;xxx&#39;.padEnd(2, &#39;ab&#39;) // &#39;xxx&#39;
</code></pre>
<p>如果用来补全的字符串与原字符串，两者的长度之和超过了指定的最小长度，则会截去超出位数的补全字符串</p>
<pre><code>    &#39;abc&#39;.padStart(10, &#39;0123456789&#39;)
    // &#39;0123456abc&#39;
</code></pre>
<p>如果省略第二个参数，默认使用空格补全长度</p>
<pre><code>    &#39;x&#39;.padStart(4) // &#39;   x&#39;
    &#39;x&#39;.padEnd(4) // &#39;x   &#39;
</code></pre>
<p><code>padStart</code>的常见用途是为数值补全指定位数。下面代码生成 10 位的数值字符串</p>
<pre><code>    &#39;1&#39;.padStart(10, &#39;0&#39;) // &quot;0000000001&quot;
    &#39;12&#39;.padStart(10, &#39;0&#39;) // &quot;0000000012&quot;
    &#39;123456&#39;.padStart(10, &#39;0&#39;) // &quot;0000123456&quot;
</code></pre>
<p>另一个用途是提示字符串格式。</p>
<pre><code>    &#39;12&#39;.padStart(10, &#39;YYYY-MM-DD&#39;) // &quot;YYYY-MM-12&quot;
    &#39;09-12&#39;.padStart(10, &#39;YYYY-MM-DD&#39;) // &quot;YYYY-09-12&quot;
</code></pre>
<h2 id="matchAll"><a href="#matchAll" class="headerlink" title="matchAll()"></a>matchAll()</h2><p><code>matchAll</code>方法返回一个正则表达式在当前字符串的所有匹配</p>
<h2 id="模板字符串"><a href="#模板字符串" class="headerlink" title="模板字符串"></a>模板字符串</h2><p>传统的 JavaScript 语言，输出模板通常是这样写的(下面使用了 jQuery 的方法)。</p>
<pre><code>    $(&#39;#result&#39;).append(
        &#39;There are &lt;b&gt;&#39; +
            basket.count +
            &#39;&lt;/b&gt; &#39; +
            &#39;items in your basket, &#39; +
            &#39;&lt;em&gt;&#39; +
            basket.onSale +
            &#39;&lt;/em&gt; are on sale!&#39;
    )
</code></pre>
<p>上面这种写法相当繁琐不方便，ES6 引入了模板字符串解决这个问题。</p>
<pre><code>    $(&#39;#result&#39;).append(`
        There are &lt;b&gt;$&#123;basket.count&#125;&lt;/b&gt; items
        in your basket, &lt;em&gt;$&#123;basket.onSale&#125;&lt;/em&gt;
        are on sale!
    `)
</code></pre>
<p>模板字符串(template string)是增强版的字符串，用反引号(```)标识。它可以当作普通字符串使用，也可以用来定义多行字符串，或者在字符串中嵌入变量</p>
<pre><code>    // 普通字符串
    ;`In JavaScript &#39;\n&#39; is a line-feed.` // 多行字符串
    `In JavaScript this is not legal.`

    console.log(`string text line 1 string text line 2`)

    // 字符串中嵌入变量
    let name = &#39;Bob&#39;,
        time = &#39;today&#39;
    ;`Hello $&#123;name&#125;, how are you $&#123;time&#125;?` 
        // Hello Bob, how are you today?
</code></pre>
<p>上面代码中的模板字符串，都是用反引号表示。如果在模板字符串中需要使用反引号，则前面要用反斜杠转义。</p>
<pre><code>    let greeting = `\`Yo\` World!`
</code></pre>
<p>如果使用模板字符串表示多行字符串，所有的空格和缩进都会被保留在输出之中。</p>
<pre><code>    $(&quot;#list&quot;).html(`
    &lt;ul&gt;
      &lt;li&gt;first&lt;/li&gt;
      &lt;li&gt;second&lt;/li&gt;
    &lt;/ul&gt;
    `)
</code></pre>
<p>上面代码中，所有模板字符串的空格和换行，都是被保留的，比如<code>&lt;ul&gt;</code>标签前面会有一个换行。如果您不想要这个换行，可以使用<code>trim</code>方法消除它</p>
<pre><code>    $(&quot;#list&quot;).html(
      `
    &lt;ul&gt;
      &lt;li&gt;first&lt;/li&gt;
      &lt;li&gt;second&lt;/li&gt;
    &lt;/ul&gt;
    `.trim()
    )
</code></pre>
<p>模板字符串中嵌入变量，需要将变量名写在<code>$&#123;&#125;</code>之中。</p>
<pre><code>    function authorize(user, action) &#123;
        if (!user.hasPrivilege(action)) &#123;
            throw new Error(
                // 传统写法为
                // &#39;User &#39;
                // + user.name
                // + &#39; is not authorized to do &#39;
                // + action
                // + &#39;.&#39;
                `User $&#123;user.name&#125; is not authorized to do $&#123;action&#125;.`
            )
        &#125;
    &#125;
</code></pre>
<p>大括号内部可以放入任意的 JavaScript 表达式，可以进行运算，以及引用对象属性。</p>
<pre><code>    let x = 1
    let y = 2

    ;`$&#123;x&#125; + $&#123;y&#125; = $&#123;x + y&#125;` // &quot;1 + 2 = 3&quot;
    `$&#123;x&#125; + $&#123;y * 2&#125; = $&#123;x + y * 2&#125;`
    // &quot;1 + 4 = 5&quot;

    let obj = &#123; x: 1, y: 2 &#125;
    ;`$&#123;obj.x + obj.y&#125;`
    // &quot;3&quot;
</code></pre>
<p>模板字符串之中还能调用函数。</p>
<pre><code>    function fn() &#123;
        return &#39;Hello World&#39;
    &#125;

    ;`foo $&#123;fn()&#125; bar`
    // foo Hello World bar
</code></pre>
<p>如果大括号中的值不是字符串，将按照一般的规则转为字符串。比如，大括号中是一个对象，将默认调用对象的<code>toString</code>方法</p>
<p>如果模板字符串中的变量没有声明，将报错。</p>
<pre><code>    // 变量place没有声明
    let msg = `Hello, $&#123;place&#125;`
    // 报错
</code></pre>
<p>由于模板字符串的大括号内部，就是执行 JavaScript 代码，因此如果大括号内部是一个字符串，将会原样输出</p>
<pre><code>    `Hello $&#123;&quot;World&quot;&#125;`
    // &quot;Hello World&quot;
</code></pre>
<h2 id="标签模板"><a href="#标签模板" class="headerlink" title="标签模板"></a>标签模板</h2><p>模板字符串的功能，不仅仅是上面这些。它可以紧跟在一个函数名后面，该函数将被调用来处理这个模板字符串。这被称为“标签模板”功能(tagged template)。</p>
<pre><code>    alert`123`
    // 等同于
    alert(123)
</code></pre>
<p>标签模板其实不是模板，而是函数调用的一种特殊形式。“标签”指的就是函数，紧跟在后面的模板字符串就是它的参数。 </p>
<p>但是，如果模板字符里面有变量，就不是简单的调用了，而是会将模板字符串先处理成多个参数，再调用函数。</p>
<pre><code>    let a = 5
    let b = 10

    tag`Hello $&#123;a + b&#125; world $&#123;a * b&#125;`
    // 等同于
    tag([&#39;Hello &#39;, &#39; world &#39;, &#39;&#39;], 15, 50)
</code></pre>
<p>上面代码中，模板字符串前面有一个标识名tag，它是一个函数。整个表达式的返回值，就是tag函数处理模板字符串后的返回值。</p>
<p>函数<code>tag</code>依次会接收到多个参数。</p>
<pre><code>    function tag(stringArr, value1, value2) &#123;
        // ...
    &#125;

    // 等同于

    function tag(stringArr, ...values) &#123;
        // ...
    &#125;
</code></pre>
<p><code>tag</code>函数的第一个参数是一个数组，该数组的成员是模板字符串中那些没有变量替换的部分，也就是说，变量替换只发生在数组的第一个成员与第二个成员之间、第二个成员与第三个成员之间，以此类推。 </p>
<p><code>tag</code>函数的其他参数，都是模板字符串各个变量被替换后的值。由于本例中，模板字符串含有两个变量，因此<code>tag</code>会接受到<code>value1</code>和<code>value2</code>两个参数。</p>
<p><code>tag</code>函数的第一个参数是一个数组，该数组的成员是模板字符串中那些没有变量替换的部分，也就是说，变量替换只发生在数组的第一个成员与第二个成员之间、第二个成员与第三个成员之间，以此类推。 </p>
<p><code>tag</code>函数的其他参数，都是模板字符串各个变量被替换后的值。由于本例中，模板字符串含有两个变量，因此<code>tag</code>会接受到<code>value1</code>和<code>value2</code>两个参数。 </p>
<p>tag函数所有参数的实际值如下。 </p>
<ul>
<li>第一个参数: [‘Hello ‘, ‘ world ‘, ‘’] </li>
<li>第二个参数: 15 </li>
<li>第三个参数: 50 </li>
</ul>
<p>也就是说，tag函数实际上以下面的形式调用。</p>
<pre><code>    tag([&quot;Hello &quot;, &quot; world &quot;, &quot;&quot;], 15, 50)
</code></pre>
<p>我们可以按照需要编写<code>tag</code>函数的代码。下面是<code>tag</code>函数的一种写法，以及运行结果。</p>
<pre><code>    let a = 5
    let b = 10

    function tag(s, v1, v2) &#123;
        console.log(s[0])
        console.log(s[1])
        console.log(s[2])
        console.log(v1)
        console.log(v2)

        return &#39;OK&#39;
    &#125;

    tag`Hello $&#123;a + b&#125; world $&#123;a * b&#125;`
    // &quot;Hello &quot;
    // &quot; world &quot;
    // &quot;&quot;
    // 15
    // 50
    // &quot;OK&quot;
</code></pre>
<p>“标签模板”的一个重要应用，就是过滤 HTML 字符串，防止用户输入恶意内容。</p>
<pre><code>    let message = SaferHTML`&lt;p&gt;$&#123;sender&#125; has sent you a message.&lt;/p&gt;`

    function SaferHTML(templateData) &#123;
        let s = templateData[0]
        for (let i = 1; i &lt; arguments.length; i++) &#123;
            let arg = String(arguments[i])

            // Escape special characters in the substitution.
            s += arg
                .replace(/&amp;/g, &#39;&amp;amp;&#39;)
                .replace(/&lt;/g, &#39;&amp;lt;&#39;)
                .replace(/&gt;/g, &#39;&amp;gt;&#39;)

            // Don&#39;t escape special characters in the template.
            s += templateData[i]
        &#125;
        return s
    &#125;
</code></pre>
<p>上面代码中，<code>sender</code>变量往往是用户提供的，经过<code>SaferHTML</code>函数处理，里面的特殊字符都会被转义。</p>
<pre><code>    let sender = &#39;&lt;script&gt;alert(&quot;abc&quot;)&lt;/script&gt;&#39; // 恶意代码
    let message = SaferHTML`&lt;p&gt;$&#123;sender&#125; has sent you a message.&lt;/p&gt;`
    
    message
    // &lt;p&gt;&amp;lt;script&amp;gt;alert(&quot;abc&quot;)&amp;lt;/script&amp;gt; has sent you a message.&lt;/p&gt;
</code></pre>
<h2 id="String-raw"><a href="#String-raw" class="headerlink" title="String.raw()"></a>String.raw()</h2><p>ES6 还为原生的 String 对象，提供了一个<code>raw</code>方法。</p>
<p><code>String.raw</code>方法，往往用来充当模板字符串的处理函数，返回一个斜杠都被转义(即斜杠前面再加一个斜杠)的字符串，对应于替换变量后的模板字符串</p>
<pre><code>    String.raw`Hi\n$&#123;2 + 3&#125;!`
    // 返回 &quot;Hi\\n5!&quot;

    String.raw`Hi\u000A!`
    // 返回 &quot;Hi\\u000A!&quot;
</code></pre>
<p>如果原字符串的斜杠已经转义，那么<code>String.raw</code>会进行再次转义。</p>
<pre><code>    String.raw`Hi\\n`
    // 返回 &quot;Hi\\\\n&quot;
</code></pre>
<p><code>String.raw</code>方法可以作为处理模板字符串的基本方法，它会将所有变量替换，而且对斜杠进行转义，方便下一步作为字符串来使用。 </p>
<p><code>String.raw</code>方法也可以作为正常的函数使用。这时，它的第一个参数，应该是一个具有<code>raw</code>属性的对象，且<code>raw</code>属性的值应该是一个数组。</p>
<pre><code>    String.raw(&#123; raw: &#39;test&#39; &#125;, 0, 1, 2)
    // &#39;t0e1s2t&#39;

    // 等同于
    String.raw(&#123; raw: [&#39;t&#39;, &#39;e&#39;, &#39;s&#39;, &#39;t&#39;] &#125;, 0, 1, 2)
</code></pre>
<p>作为函数，<code>String.raw</code>的代码实现基本如下</p>
<pre><code>    String.raw = function (strings, ...values) &#123;
        let output = &#39;&#39;
        let index
        for (index = 0; index &lt; values.length; index++) &#123;
            output += strings.raw[index] + values[index]
        &#125;

        output += strings.raw[index]
        return output
    &#125;
</code></pre>
<h2 id="模板字符串的限制"><a href="#模板字符串的限制" class="headerlink" title="模板字符串的限制"></a>模板字符串的限制</h2><p>前面提到标签模板里面，可以内嵌其他语言。但是，模板字符串默认会将字符串转义，导致无法嵌入其他语言。</p>
<p>举例来说，标签模板里面可以嵌入 LaTEX 语言。</p>
<pre><code>    function latex(strings) &#123;
        // ...
    &#125;

    let document = latex`
        \newcommand&#123;\fun&#125;&#123;\textbf&#123;Fun!&#125;&#125;  // 正常工作
        \newcommand&#123;\unicode&#125;&#123;\textbf&#123;Unicode!&#125;&#125; // 报错
        \newcommand&#123;\xerxes&#125;&#123;\textbf&#123;King!&#125;&#125; // 报错

        Breve over the h goes \u&#123;h&#125;ere // 报错
        `
</code></pre>
<p>上面代码中，变量<code>document</code>内嵌的模板字符串，对于 LaTEX 语言来说完全是合法的，但是 JavaScript 引擎会报错。原因就在于字符串的转义。 </p>
<p>模板字符串会将<code>\u00FF</code>和<code>\u&#123;42&#125;</code>当作 Unicode 字符进行转义，所以解析<code>\unicode</code>时报错；而<code>\x56</code>会被当作十六进制字符串转义，所以<code>\xerxes</code>会报错。<br>也就是说，<code>\u</code>和<code>\x</code>在 LaTEX 里面有特殊含义，但是 JavaScript 将它们转义了。 </p>
<p>为了解决这个问题，ES2018 放松了对标签模板里面的字符串转义的限制。如果遇到不合法的字符串转义，就返回<code>undefined</code>，而不是报错，并且从<code>raw</code>属性上面可以得到原始字符串。</p>
<pre><code>    function tag(strs) &#123;
        strs[0] === undefined
        strs.raw[0] === &#39;\\unicode and \\u&#123;55&#125;&#39;
    &#125;
    tag`\unicode and \u&#123;55&#125;`
</code></pre>
<p>上面代码中，模板字符串原本是应该报错的，但是由于放松了对字符串转义的限制，所以不报错了，JavaScript 引擎将第一个字符设置为<code>undefined</code>，但是raw属性依然可以得到原始字符串，因此<code>tag</code>函数还是可以对原字符串进行处理。 </p>
<p>注意，这种对字符串转义的放松，只在标签模板解析字符串时生效，不是标签模板的场合，依然会报错</p>
<pre><code>    let bad = `bad escape sequence: \unicode` // 报错
</code></pre>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/javaScript/" rel="tag"># javaScript</a>
              <a href="/tags/ES6/" rel="tag"># ES6</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/07/23/ES6/Moudle%20%E7%9A%84%E5%8A%A0%E8%BD%BD%E5%AE%9E%E7%8E%B0/" rel="prev" title="Module 的加载实现">
      <i class="fa fa-chevron-left"></i> Module 的加载实现
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/07/29/vue/Vue%E5%AE%9E%E4%BE%8B%E5%AF%B9%E8%B1%A1/" rel="next" title="Vue实例对象">
      Vue实例对象 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%89%A9%E5%B1%95"><span class="nav-number">1.</span> <span class="nav-text">字符串的扩展</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E7%9A%84-Unicode-%E8%A1%A8%E7%A4%BA%E6%B3%95"><span class="nav-number">1.1.</span> <span class="nav-text">字符的 Unicode 表示法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#codePointAt"><span class="nav-number">1.2.</span> <span class="nav-text">codePointAt()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#String-fromCodePoint"><span class="nav-number">1.3.</span> <span class="nav-text">String.fromCodePoint()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E9%81%8D%E5%8E%86%E5%99%A8%E6%8E%A5%E5%8F%A3"><span class="nav-number">1.4.</span> <span class="nav-text">字符串的遍历器接口</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#includes-startsWith-endsWith"><span class="nav-number">1.5.</span> <span class="nav-text">includes(), startsWith(), endsWith()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#repeat"><span class="nav-number">1.6.</span> <span class="nav-text">repeat()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#padStart-%EF%BC%8CpadEnd"><span class="nav-number">1.7.</span> <span class="nav-text">padStart()，padEnd()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#matchAll"><span class="nav-number">1.8.</span> <span class="nav-text">matchAll()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">1.9.</span> <span class="nav-text">模板字符串</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%87%E7%AD%BE%E6%A8%A1%E6%9D%BF"><span class="nav-number">1.10.</span> <span class="nav-text">标签模板</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#String-raw"><span class="nav-number">1.11.</span> <span class="nav-text">String.raw()</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E9%99%90%E5%88%B6"><span class="nav-number">1.12.</span> <span class="nav-text">模板字符串的限制</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Fangck"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Fangck</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">42</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019-12 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Fangck</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">全站共84.1k字</span>
</div>
        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
